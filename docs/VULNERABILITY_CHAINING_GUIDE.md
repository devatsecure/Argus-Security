# ğŸ”— Vulnerability Chaining System - Complete Guide

## Overview

The **Vulnerability Chaining System** automatically discovers how multiple vulnerabilities can be combined into critical multi-step attack scenarios. It transforms isolated low/medium severity findings into actionable, high-risk security insights.

### Key Benefits

âœ… **Reveals Hidden Critical Risks** - Discovers severe attack paths from medium/low findings  
âœ… **Risk Amplification** - Calculates exponential risk growth (2 vulns = 1.5Ã—, 3 vulns = 2.25Ã—)  
âœ… **Realistic Attack Scenarios** - Shows actual exploit paths attackers would use  
âœ… **Prioritized Remediation** - Focus on vulnerabilities that enable critical chains  
âœ… **Compliance Ready** - Demonstrates risk analysis for audits  

---

## ğŸš€ Quick Start

### 1. Basic Usage

```bash
# Analyze findings for chains
python scripts/vulnerability_chaining_engine.py \
    --input scan-results.json \
    --output chains.json

# Visualize results
python scripts/chain_visualizer.py \
    --input chains.json \
    --output-md chain-report.md \
    --console
```

### 2. Python API

```python
from vulnerability_chaining_engine import VulnerabilityChainer
from chain_visualizer import ChainVisualizer

# Create chainer
chainer = VulnerabilityChainer(
    max_chain_length=4,      # Max vulnerabilities per chain
    min_risk_threshold=5.0   # Only report chains >= 5.0 risk
)

# Analyze findings
result = chainer.analyze(findings)

# Print to console
visualizer = ChainVisualizer()
visualizer.print_console_report(result)

# Generate reports
visualizer.generate_markdown_report(result, "chain-report.md")
visualizer.generate_json_summary(result, "chain-summary.json")
```

---

## ğŸ“Š How It Works

### 1. **Attack Graph Construction**

The system builds a directed graph where:
- **Nodes** = Individual vulnerabilities
- **Edges** = Exploitable transitions between vulnerabilities

```
     [IDOR]
        â†“
  [Priv Escalation]
        â†“
   [Data Breach]
```

### 2. **Chain Detection Algorithm**

```python
# Find entry points (externally accessible)
entry_points = find_trivially_exploitable()

# Find high-value targets (critical impact)
targets = find_high_value_targets()

# Find all paths from entry to target
for entry in entry_points:
    for target in targets:
        paths = find_all_paths(entry, target, max_length=4)
        
        for path in paths:
            chain = AttackChain(path)
            if chain.risk_score >= threshold:
                report(chain)
```

### 3. **Risk Amplification Formula**

```
Base Risk = Î£(individual severity scores)
Amplification = 1.5 ^ (chain_length - 1)
Final Risk = min(Base Risk Ã— Amplification, 10.0)

Example:
  3 medium vulns (5.0 each)
  Base: 5.0 + 5.0 + 5.0 = 15.0
  Amplification: 1.5 ^ 2 = 2.25
  Final: min(15.0 Ã— 2.25, 10.0) = 10.0 (CRITICAL!)
```

---

## ğŸ¯ Chaining Rules

### Built-In Rules

The system includes 15+ pre-configured chaining rules:

| Source Vulnerability | Target Vulnerability | Probability | Description |
|---------------------|---------------------|-------------|-------------|
| **IDOR** | Privilege Escalation | 80% | Access to other users â†’ admin access |
| **XSS** | Session Hijacking | 85% | Steal tokens via JavaScript |
| **SSRF** | Internal Network | 75% | Access internal services |
| **Path Traversal** | Arbitrary File Read | 90% | Read sensitive files |
| **SQLi** | Database Access | 95% | Direct database access |
| **CSRF** | Unauthorized Action | 80% | Force victim actions |
| **Broken Auth** | Account Access | 90% | Bypass authentication |
| **Command Injection** | System Access | 90% | System-level control |

### Adding Custom Rules

```python
custom_rules = [
    {
        'source': 'API_MISCONFIGURATION',
        'target': 'DATA_EXPOSURE',
        'probability': 0.85,
        'description': 'API misconfig exposes sensitive data'
    },
]

# Load custom rules
chainer.graph.chain_rules.extend(custom_rules)
```

---

## ğŸ“ˆ Real-World Examples

### Example 1: Account Takeover Chain

**Individual Findings:**
- â¶ XSS in profile bio (Medium - 5.0)
- â· CORS misconfiguration (Low - 3.0)
- â¸ Session token in URL (Medium - 5.0)

**Chained Together:**
```
Risk: (5.0 + 3.0 + 5.0) Ã— 1.5Â² = 29.25 â†’ Capped at 10.0 (CRITICAL)

Attack Scenario:
1. Inject XSS in profile bio
2. Use CORS to exfiltrate to attacker domain
3. Steal session token from URL
4. Full account access â†’ CRITICAL IMPACT
```

### Example 2: Data Breach Chain

**Individual Findings:**
- â¶ IDOR in /api/users/{id} (Medium - 5.0)
- â· Missing admin role check (Medium - 6.0)
- â¸ PII in admin endpoint (High - 7.0)

**Chained Together:**
```
Risk: (5.0 + 6.0 + 7.0) Ã— 1.5Â² = 40.5 â†’ Capped at 10.0 (CRITICAL)

Attack Scenario:
1. Use IDOR to access any user profile
2. Find admin user ID
3. Escalate to admin (no role check)
4. Download entire customer database
5. 100,000 records exposed â†’ DATA BREACH
```

### Example 3: RCE Chain

**Individual Findings:**
- â¶ SSRF in image proxy (Medium - 6.0)
- â· Path traversal (Medium - 5.0)
- â¸ Command injection (High - 8.0)

**Chained Together:**
```
Risk: (6.0 + 5.0 + 8.0) Ã— 1.5Â² = 42.75 â†’ Capped at 10.0 (CRITICAL)

Attack Scenario:
1. SSRF to access internal network (192.168.x.x)
2. Path traversal to read /etc/passwd, SSH keys
3. Command injection to execute arbitrary code
4. Install backdoor, exfiltrate data â†’ FULL COMPROMISE
```

---

## ğŸ”§ Configuration

### Command-Line Options

```bash
python scripts/vulnerability_chaining_engine.py \
    --input findings.json \           # Input findings
    --output chains.json \            # Output chains
    --max-length 4 \                  # Max chain length
    --min-risk 5.0 \                  # Min risk threshold
    --verbose                         # Verbose logging
```

### Python Configuration

```python
from vulnerability_chaining_engine import VulnerabilityChainer

chainer = VulnerabilityChainer(
    max_chain_length=4,           # Maximum vulnerabilities per chain
    min_risk_threshold=5.0,       # Only report chains >= this risk
)

# Customize behavior
chainer.graph.chain_rules = load_custom_rules()
chainer.graph.high_value_categories.add('CUSTOM_CATEGORY')
```

---

## ğŸ“Š Output Formats

### 1. JSON Output

```json
{
  "timestamp": "2026-01-27T14:00:00Z",
  "total_vulnerabilities": 25,
  "total_chains": 8,
  "chains": [
    {
      "chain_id": "abc123def456",
      "risk_score": 10.0,
      "base_risk": 18.0,
      "amplification_factor": 2.25,
      "complexity": "medium",
      "exploitability": "critical",
      "chain_length": 3,
      "vulnerabilities": [...]
    }
  ],
  "statistics": {
    "avg_chain_length": 2.8,
    "critical_chains": 3,
    "high_chains": 5
  }
}
```

### 2. Markdown Report

```markdown
## Chain #1: Risk Score 10.0/10.0

**Exploitability:** Critical | **Complexity:** Medium | **Time:** 1-4 hours

**Base Risk:** 18.0 â†’ **Amplified Risk:** 10.0 (Ã—2.25 multiplier)

### Attack Scenario
```
Step 1: IDOR [MEDIUM]
  ğŸ“ File: /api/users.py
  ğŸ“ Missing access control
    â†“
Step 2: PRIVILEGE_ESCALATION [HIGH]
  ğŸ“ File: /api/auth.py
  ğŸ“ No admin role validation
    â†“
Step 3: DATA_BREACH [CRITICAL]
  ğŸ“ File: /api/admin.py
  ğŸ“ PII exposed
```

**ğŸ’¥ Final Impact:** Data breach affecting 100K+ users
```

### 3. Console Output

```
ğŸ”— VULNERABILITY CHAINING ANALYSIS REPORT
================================================================================

ğŸ“Š Statistics:
   Total Vulnerabilities: 25
   Attack Chains Found: 8
   Critical Chains: 3
   High-Risk Chains: 5
   Avg Chain Length: 2.8
   Avg Risk Score: 8.2/10.0

ğŸ”— Top 5 Attack Chains:
================================================================================

Chain #1: Risk 10.0/10.0
Exploitability: Critical | Complexity: Medium | Time: 1-4 hours
Amplification: 18.0 â†’ 10.0 (Ã—2.25)

ğŸ­ Attack Flow:
  Step 1: IDOR [MEDIUM]
  ğŸ“ /api/users.py
  ğŸ“ Missing access control on user ID parameter
    â†“
  Step 2: PRIVILEGE_ESCALATION [HIGH]
  ğŸ“ /api/auth.py
  ğŸ“ No admin role validation
    â†“
  Step 3: DATA_BREACH [CRITICAL]
  ğŸ“ /api/admin.py
  ğŸ“ PII exposed without encryption

ğŸ’¥ Impact: Data breach affecting 100K+ users
```

---

## ğŸ§ª Testing

### Run Test Suite

```bash
# Run all tests
python tests/test_vulnerability_chaining.py

# Run specific test class
python -m unittest tests.test_vulnerability_chaining.TestAttackChain

# Run with verbose output
python tests/test_vulnerability_chaining.py --verbose
```

### Test Coverage

- âœ… Unit tests for all components
- âœ… Integration tests for end-to-end flow
- âœ… Edge cases (no chains, single vuln, etc.)
- âœ… Risk calculation validation
- âœ… Chaining rules validation

---

## ğŸ”— Integration with Argus

### Automatic Integration

The chaining system automatically integrates with the hybrid analyzer:

```bash
# Run complete scan with chaining
python scripts/hybrid_analyzer.py /path/to/repo \
    --enable-vulnerability-chaining \
    --output-dir ./results
```

### Manual Integration

```python
# Run regular scan
from hybrid_analyzer import HybridSecurityAnalyzer

analyzer = HybridSecurityAnalyzer()
results = analyzer.analyze('/path/to/repo')

# Analyze chains
from vulnerability_chaining_engine import VulnerabilityChainer

chainer = VulnerabilityChainer()
chains = chainer.analyze(results['findings'])

# Combine results
results['vulnerability_chains'] = chains
```

---

## ğŸ“š Examples

See `examples/vulnerability_chaining_example.py` for:

1. **Simple Chain** - IDOR â†’ Privilege Escalation
2. **Account Takeover** - XSS â†’ CSRF â†’ Session Hijacking
3. **Data Breach** - SQLi â†’ Database Access â†’ Data Exfiltration
4. **RCE Chain** - SSRF â†’ Path Traversal â†’ Command Injection
5. **Load from File** - Using real scan results

Run examples:
```bash
python examples/vulnerability_chaining_example.py
```

---

## ğŸ¯ Best Practices

### 1. **Set Appropriate Thresholds**
```python
# For initial analysis (see everything)
chainer = VulnerabilityChainer(min_risk_threshold=0.0)

# For production (only critical chains)
chainer = VulnerabilityChainer(min_risk_threshold=7.5)
```

### 2. **Limit Chain Length**
```python
# Shorter chains (more realistic)
chainer = VulnerabilityChainer(max_chain_length=3)

# Longer chains (comprehensive analysis)
chainer = VulnerabilityChainer(max_chain_length=5)
```

### 3. **Focus on Entry Points**
Ensure findings include:
- `exploitability`: trivial, moderate, difficult
- `reachability`: yes, no, partial

### 4. **Custom Chaining Rules**
Add domain-specific rules for your application

---

## ğŸ†˜ Troubleshooting

### No Chains Found

**Problem:** `total_chains: 0`

**Solutions:**
1. Lower `min_risk_threshold` to 0.0
2. Check if findings have `exploitability` and `reachability`
3. Add custom chaining rules for your vulnerabilities
4. Verify findings have proper categories

### NetworkX Not Available

**Problem:** `networkx not available - using fallback`

**Solution:**
```bash
pip install networkx
```

### Low Risk Scores

**Problem:** All chains have low risk scores

**Solution:**
- Include more high-severity findings
- Check severity mappings
- Adjust amplification formula if needed

---

## ğŸ“Š Performance

- **Typical Scan:** 50-100 vulnerabilities â†’ < 1 second
- **Large Scan:** 500+ vulnerabilities â†’ 2-5 seconds
- **Memory:** O(NÂ²) for graph construction
- **Complexity:** O(N Ã— M Ã— K) where N=nodes, M=targets, K=max_length

---

## ğŸ”® Future Enhancements

- [ ] Machine learning for chain probability
- [ ] Real-time chain detection during scanning
- [ ] Interactive chain visualization (web UI)
- [ ] Attack tree generation
- [ ] Exploit PoC generation for chains
- [ ] Integration with MITRE ATT&CK

---

## ğŸ“ Support

- **Documentation:** This file
- **Examples:** `examples/vulnerability_chaining_example.py`
- **Tests:** `tests/test_vulnerability_chaining.py`
- **Issues:** GitHub Issues

---

**Built with â¤ï¸ by the Argus Security team**
